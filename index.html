<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="global.page_title">MASKSERVICE C20 1001 - System Mock v2.0</title>
    <script>
        // Cache-busting for CSS
        const cssVersion = Date.now();
        document.write('<link rel="stylesheet" href="css/style.css?v=' + cssVersion + '">');
    </script>
</head>
<body>
<div id="app" class="container">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <a href="/">
                <span class="logo" data-i18n="global.logo">MASKSERVICE</span>
                <span class="hardware" data-i18n="global.hardware">C20</span>
                <span class="product" data-i18n="global.product">1001</span>
                <span class="software" data-i18n="global.software">v2.0 MOCK</span>
            </a>

        </div>
        <div class="header-center">
            <span  id="device-url" id="device_connection_status" class="status-indicator">
                <span id="device_url" class="footer-host">
                    <a href="https://c201001.mask.services" data-i18n="global.device_url_label">c201001.mask.services</a>
                </span>
                <span class="status-dot"></span>
                <span id="status-text"  class="role-badge" data-i18n="global.offline">OFFLINE</span>
            </span>

        </div>

        <div class="header-right">

            <span id="device-info">
                    <span id="device_name" data-i18n="global.device_name">CONNECT</span>
                    <span id="device_type" data-i18n="global.device_type">500</span>
            </span>

        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Screen -->
        <div id="login-screen" class="screen active">
            <div class="menu-container">
                <!--                    <div class="menu-header" data-i18n="login.menu_header">LOGIN MENU</div>-->
                <div class="menu-layout">
                    <div class="menu-sidebar">
                             <span class="start-buttons">

                        <button id="login-scanner-btn" class="menu-item"
                                onclick="navigateAction('login-scanner-btn'); selectLoginMethod('scanner')"
                                data-i18n="login.scanner">Scanner
                        </button>
                        <button id="login-keyword-btn" class="menu-item active"
                                onclick="navigateAction('login-keyword-btn'); selectLoginMethod('keyword')"
                                data-i18n="login.keyword">Keyword
                        </button>

                                    </span>
                        <span class="login-buttons">
                                        <button id="login-operator-btn" class="menu-item btn-green"
                                                onclick="navigateAction('login-operator-btn'); mockLogin('OPERATOR')">
                                            Login as OPERATOR
                                        </button>
                                        <button id="login-admin-btn" class="menu-item btn-yellow"
                                                onclick="navigateAction('login-admin-btn'); mockLogin('ADMIN')">Login as
                                            ADMIN
                                        </button>
                                        <button id="login-superuser-btn" class="menu-item btn-red"
                                                onclick="navigateAction('login-superuser-btn'); mockLogin('SUPERUSER')">
                                            Login as SUPERUSER
                                        </button>
                                        <button id="login-serwisant-btn" class="menu-item btn-blue"
                                                onclick="navigateAction('login-serwisant-btn'); mockLogin('SERWISANT')">
                                            Login as SERWISANT
                                        </button>

                                    </span>

                    </div>
                    <div class="menu-content">
                        <div id="login-keyword" class="login-method active">
                            <h2 data-i18n="login.user_login_by_keyword">User Login By Keyword</h2>
                            <div class="login-form">
                                <div class="password-container">
                                    <input type="password" id="password-input" placeholder="Password"
                                           data-i18n-placeholder="login.password_placeholder"
                                           readonly="readonly" 
                                           inputmode="none"
                                           autocomplete="off"
                                           onclick="this.focus()"
                                           onfocus="this.removeAttribute('readonly')">
                                    <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
                                </div>
                                <div class="keyboard-container">
                                    <div class="virtual-keyboard" id="virtual-keyboard">
                                        <!-- Row 1 -->
                                        <div class="keyboard-row">
                                            <div id="key-1" class="keyboard-key" data-char="1" data-shift-char="!">
                                                1<span class="sub-char">!</span></div>
                                            <div id="key-2" class="keyboard-key" data-char="2" data-shift-char="@">
                                                2<span class="sub-char">@</span></div>
                                            <div id="key-3" class="keyboard-key" data-char="3" data-shift-char="#">
                                                3<span class="sub-char">#</span></div>
                                            <div id="key-4" class="keyboard-key" data-char="4" data-shift-char="$">
                                                4<span class="sub-char">$</span></div>
                                            <div id="key-5" class="keyboard-key" data-char="5" data-shift-char="%">
                                                5<span class="sub-char">%</span></div>
                                            <div id="key-6" class="keyboard-key" data-char="6" data-shift-char="^">
                                                6<span class="sub-char">^</span></div>
                                            <div id="key-7" class="keyboard-key" data-char="7" data-shift-char="&">
                                                7<span class="sub-char">&</span></div>
                                            <div id="key-8" class="keyboard-key" data-char="8" data-shift-char="*">
                                                8<span class="sub-char">*</span></div>
                                            <div id="key-9" class="keyboard-key" data-char="9" data-shift-char="(">
                                                9<span class="sub-char">(</span></div>
                                            <div id="key-0" class="keyboard-key" data-char="0" data-shift-char=")">
                                                0<span class="sub-char">)</span></div>
                                            <div id="key-backspace" class="keyboard-key special backspace"
                                                 data-action="backspace">‚å´
                                            </div>
                                        </div>
                                        <!-- Row 2 -->
                                        <div class="keyboard-row">
                                            <div id="key-q" class="keyboard-key" data-char="q" data-shift-char="Q">q
                                            </div>
                                            <div id="key-w" class="keyboard-key" data-char="w" data-shift-char="W">w
                                            </div>
                                            <div id="key-e" class="keyboard-key" data-char="e" data-shift-char="E">e
                                            </div>
                                            <div id="key-r" class="keyboard-key" data-char="r" data-shift-char="R">r
                                            </div>
                                            <div id="key-t" class="keyboard-key" data-char="t" data-shift-char="T">t
                                            </div>
                                            <div id="key-y" class="keyboard-key" data-char="y" data-shift-char="Y">y
                                            </div>
                                            <div id="key-u" class="keyboard-key" data-char="u" data-shift-char="U">u
                                            </div>
                                            <div id="key-i" class="keyboard-key" data-char="i" data-shift-char="I">i
                                            </div>
                                            <div id="key-o" class="keyboard-key" data-char="o" data-shift-char="O">o
                                            </div>
                                            <div id="key-p" class="keyboard-key" data-char="p" data-shift-char="P">p
                                            </div>
                                        </div>
                                        <!-- Row 3 -->
                                        <div class="keyboard-row">
                                            <div id="key-caps" class="keyboard-key special caps" data-action="caps"
                                                 data-i18n="keyboard.caps">Caps
                                            </div>
                                            <div id="key-a" class="keyboard-key" data-char="a" data-shift-char="A">a
                                            </div>
                                            <div id="key-s" class="keyboard-key" data-char="s" data-shift-char="S">s
                                            </div>
                                            <div id="key-d" class="keyboard-key" data-char="d" data-shift-char="D">d
                                            </div>
                                            <div id="key-f" class="keyboard-key" data-char="f" data-shift-char="F">f
                                            </div>
                                            <div id="key-g" class="keyboard-key" data-char="g" data-shift-char="G">g
                                            </div>
                                            <div id="key-h" class="keyboard-key" data-char="h" data-shift-char="H">h
                                            </div>
                                            <div id="key-j" class="keyboard-key" data-char="j" data-shift-char="J">j
                                            </div>
                                            <div id="key-k" class="keyboard-key" data-char="k" data-shift-char="K">k
                                            </div>
                                            <div id="key-l" class="keyboard-key" data-char="l" data-shift-char="L">l
                                            </div>
                                            <div id="key-enter" class="keyboard-key special enter" data-action="enter"
                                                 title="Enter">‚èé
                                            </div>
                                        </div>
                                        <!-- Row 4 -->
                                        <div class="keyboard-row">
                                            <div id="key-shift" class="keyboard-key special shift" data-action="shift">
                                                ‚áß
                                            </div>
                                            <div id="key-z" class="keyboard-key" data-char="z" data-shift-char="Z">z
                                            </div>
                                            <div id="key-x" class="keyboard-key" data-char="x" data-shift-char="X">x
                                            </div>
                                            <div id="key-c" class="keyboard-key" data-char="c" data-shift-char="C">c
                                            </div>
                                            <div id="key-v" class="keyboard-key" data-char="v" data-shift-char="V">v
                                            </div>
                                            <div id="key-b" class="keyboard-key" data-char="b" data-shift-char="B">b
                                            </div>
                                            <div id="key-n" class="keyboard-key" data-char="n" data-shift-char="N">n
                                            </div>
                                            <div id="key-m" class="keyboard-key" data-char="m" data-shift-char="M">m
                                            </div>
                                            <div id="key-comma" class="keyboard-key" data-char="," data-shift-char="<">,<span
                                                    class="sub-char"><</span></div>
                                            <div id="key-period" class="keyboard-key" data-char="." data-shift-char=">">
                                                .<span class="sub-char">></span></div>
                                            <div id="key-slash" class="keyboard-key" data-char="/" data-shift-char="?">/<span
                                                    class="sub-char">?</span></div>
                                        </div>
                                        <!-- Row 5 -->
                                        <div class="keyboard-row">
                                            <div id="key-tab" class="keyboard-key special tab" data-action="tab">Tab
                                            </div>
                                            <div id="key-space" class="keyboard-key space" data-char=" "
                                                 data-shift-char=" "></div>
                                            <div id="key-clear" class="keyboard-key special clear" data-action="clear">
                                                Clear
                                            </div>
                                            <div id="key-toggle" class="keyboard-key special toggle"
                                                 data-action="toggle">123
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div id="login-scanner" class="login-method">
                            <h2 data-i18n="login.user_login_by_scanner">User Login by QR-CODE / BARCODE</h2>
                            <div class="scanner-mock">
                                <div class="scanner-animation">
                                    <div class="scanner-line"></div>
                                </div>
                                <p class="error-msg" data-i18n="login.scanner_not_detected">+ Skaner nie zosta≈Ç wykryty</p>
                                <p data-i18n="login.code_not_read">kod nie zosta≈Ç poprawnie sczytany</p>
                                <button id="use-keyboard-btn" class="btn"
                                        onclick="navigateAction('use-keyboard-btn'); selectLoginMethod('keyword')" data-i18n="login.use_keyboard">U≈ºyj
                                    klawiatury
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Start Screen -->
        <div id="system-screen" class="screen">
            <div class="menu-container">
                <!--                <div class="menu-header">SYSTEM</div>-->
                <div class="system-content">
                    <h1 data-i18n="system.welcome">Welcome</h1>
                    <div class="system-logo" data-i18n="global.system_name">MASKTRONIC</div>
                    <div class="loading-bar">
                        <div class="loading-progress" id="loading-progress"></div>
                    </div>
                    <p id="loading-text" data-i18n="system.loading_message">System starting in Progress...</p>
                </div>
            </div>
        </div>

        <!-- User Menu Screen -->
        <div id="user-menu-screen" class="screen">
            <div class="menu-container">
                <!--                <div class="menu-header">-->
                <!--                    USER MENU-->
                <!--                    <span id="menu-role-badge" class="role-badge"></span>-->
                <!--                </div>-->
                <div class="menu-layout">
                    <div class="menu-sidebar" id="user-menu-items">
                        <!-- Dynamic menu items based on role -->
                    </div>
                    <div class="menu-content" id="menu-content">
                        <div class="welcome-message">
                            <h2 data-i18n="menu.select_option">Wybierz opcjƒô z menu</h2>
                            <p data-i18n="system.ready">System gotowy do pracy</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pressure Display Panel - Always Visible -->
        <aside id="pressure-panel" class="pressure-panel">
            <h3 id="pressure-panel-title" data-i18n="device.pressure_title">PRESSURE</h3>
            <div class="pressure-box">
                <div class="pressure-item">
                    <div id="pressure-low-label" class="pressure-label" data-i18n="device.pressure_low">Low</div>
                    <div id="pressure-low" class="pressure-value">10</div>
                    <div id="pressure-low-unit" class="pressure-unit">mbar</div>
                    <div id="pressure-low-dia" class="pressure-dia"></div>
                </div>
            </div>
            <div class="pressure-box">

                <div class="pressure-item">
                    <div id="pressure-medium-label" class="pressure-label" data-i18n="device.pressure_medium">Medium</div>
                    <div id="pressure-medium" class="pressure-value">20</div>
                    <div id="pressure-medium-unit" class="pressure-unit">bar</div>
                    <div id="pressure-medium-dia" class="pressure-dia"></div>
                </div>
            </div>
            <div class="pressure-box">

                <div class="pressure-item">
                    <div id="pressure-high-label" class="pressure-label" data-i18n="device.pressure_high">High</div>
                    <div id="pressure-high" class="pressure-value">30</div>
                    <div id="pressure-high-unit" class="pressure-unit">bar</div>
                    <div id="pressure-high-dia" class="pressure-dia"></div>

                </div>
            </div>
        </aside>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-left">
            <span id="user-info" style="display:none;">
<!--                    <span id="username">-&#45;&#45;</span>-->
                <span id="user-name" data-i18n="user.username_placeholder">USERNAME</span>
                <span id="user-role" class="role-badge">---</span>
            </span>

            <!--            <div id="session-info" class="session-info">-->
            <!--                <span>Inactive: <span id="inactive-time">0s</span></span>-->
            <!--                <button onclick="navigateAction('logout-btn'); logout()" class="btn-logout">Logout</button>-->
            <!--            </div>-->


        </div>

        <div class="footer-center">

                <span id="language-selector" class="language-selector">
                    <button id="lang-pl" class="lang-btn active" onclick="changeLanguage('pl')"
                            title="Polski">üáµüá±</button>
                    <button id="lang-en" class="lang-btn" onclick="changeLanguage('en')" title="English">üá∫üá∏</button>
                    <button id="lang-de" class="lang-btn" onclick="changeLanguage('de')" title="Deutsch">üá©üá™</button>
                </span>
        </div>

        <div class="footer-right">

            <span id="time-info" >
                <span id="footer-date">--/--/----</span>
                <span id="footer-time" class="role-badge">--:--</span>
            </span>

        </div>
    </footer>
</div>

<!-- Menu Templates -->
<div id="templates" style="display:none;">
    <!-- Test Menu Template -->
    <div id="test-menu-template">
        <h2 data-i18n="test.menu_title">Test Menu</h2>
        <div class="menu-grid">
            <button class="menu-card" onclick="selectTestOption('device')">
                <h3 data-i18n="test.kind_of_device">Kind of Device</h3>
                <p data-i18n="test.select_device_type">Wybierz rodzaj urzƒÖdzenia</p>
            </button>
            <button class="menu-card" onclick="selectTestOption('type')">
                <h3 data-i18n="test.device_type">Device Type</h3>
                <p data-i18n="test.select_device_model">Wybierz typ urzƒÖdzenia</p>
            </button>
            <button class="menu-card" onclick="selectTestOption('test')">
                <h3 data-i18n="test.kind_of_test">Kind of Test</h3>
                <p data-i18n="test.select_test_type">Wybierz rodzaj testu</p>
            </button>
            <button class="menu-card" onclick="selectTestOption('flow')">
                <h3 data-i18n="test.test_flow">Test Flow</h3>
                <p data-i18n="test.test_scenario">Scenariusz testowy</p>
            </button>
        </div>
    </div>

    <!-- Device Selection Template -->
    <div id="device-select-template">
        <h2 data-i18n="test.kind_of_device">Kind of Device</h2>
        <div class="device-list">
            <button class="device-item" onclick="selectDevice('PP_MASK')" data-i18n="devices.pp_mask">PP Mask</button>
            <button class="device-item" onclick="selectDevice('NP_MASK')" data-i18n="devices.np_mask">NP Mask</button>
            <button class="device-item" onclick="selectDevice('SCBA')" data-i18n="devices.scba">SCBA</button>
            <button class="device-item" onclick="selectDevice('CPS')" data-i18n="devices.cps">CPS Protection Suit</button>
        </div>
        <button class="btn btn-back" onclick="backToMenu()" data-i18n="navigation.back">‚Üê Powr√≥t</button>
    </div>

    <!-- Workshop Template -->
    <div id="workshop-template">
        <h2 data-i18n="workshop.title">Workshop</h2>
        <div class="menu-grid">
            <button class="menu-card">
                <h3 data-i18n="workshop.equipment_list">Equipment List</h3>
                <p data-i18n="workshop.equipment_description">Lista sprzƒôtu</p>
            </button>
            <button class="menu-card">
                <h3 data-i18n="workshop.spare_parts">Spare Parts</h3>
                <p data-i18n="workshop.spare_parts_description">Czƒô≈õci zamienne</p>
            </button>
            <button class="menu-card">
                <h3 data-i18n="workshop.maintenance">Maintenance</h3>
                <p data-i18n="workshop.maintenance_description">Harmonogram przeglƒÖd√≥w</p>
            </button>
        </div>
    </div>

    <!-- User Data Template -->
    <div id="user-data-template">
        <h2 data-i18n="user.title">User Data</h2>
        <div class="user-info-grid">
            <div class="info-card">
                <h3 data-i18n="user.current_user">Current User</h3>
                <p id="current-user-name">---</p>
                <p id="current-user-role">---</p>
            </div>
            <div class="info-card">
                <h3 data-i18n="user.session_info">Session Info</h3>
                <p data-i18n="user.login_time">Login time: <span id="login-time">---</span></p>
                <p data-i18n="user.last_activity">Last activity: <span id="last-activity">---</span></p>
            </div>
        </div>
    </div>

    <!-- Device Data Template -->
    <div id="device-data-template">
        <h2 data-i18n="device.title">Device Data</h2>
        <div class="device-info">
            <div class="device-card">
                <h3 data-i18n="device.status_title">Device Status</h3>
                <p data-i18n="device.device_id_label">Device ID: <span id="device-id">RPI_MOCK_001</span></p>
                <p data-i18n="device.status_label">Status: <span id="device-status" class="status-online">ONLINE</span></p>
                <p data-i18n="device.uptime_label">Uptime: <span id="device-uptime">---</span></p>
            </div>
            <div class="sensor-grid">
                <div class="sensor-card">
                    <h4 data-i18n="sensors.temperature">Temperature</h4>
                    <span id="temp-value">22.5¬∞C</span>
                </div>
                <div class="sensor-card">
                    <h4 data-i18n="sensors.humidity">Humidity</h4>
                    <span id="humidity-value">45%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Reports Template -->
    <div id="test-reports-template">
        <h2 data-i18n="reports.title">Test Reports</h2>
        <div class="reports-list">
            <div class="report-item">
                <span>Report #001</span>
                <span>2024-01-15</span>
                <button class="btn-small" data-i18n="reports.pdf_button">PDF</button>
            </div>
            <div class="report-item">
                <span>Report #002</span>
                <span>2024-01-16</span>
                <button class="btn-small" data-i18n="reports.pdf_button">PDF</button>
            </div>
        </div>
        <button class="btn btn-primary" data-i18n="reports.generate_new">Generate New Report</button>
    </div>

    <!-- Users Template (ADMIN) -->
    <div id="users-template">
        <h2 data-i18n="users.management_title">Users Management</h2>
        <div class="users-list">
            <div class="user-item">
                <span>operator1</span>
                <span class="role-badge role-operator" data-i18n="roles.operator">OPERATOR</span>
                <button class="btn-small" data-i18n="actions.edit">Edit</button>
            </div>
            <div class="user-item">
                <span>admin1</span>
                <span class="role-badge role-admin" data-i18n="roles.admin">ADMIN</span>
                <button class="btn-small" data-i18n="actions.edit">Edit</button>
            </div>
        </div>
        <button class="btn btn-primary" data-i18n="users.add_user">Add User</button>
    </div>

    <!-- Service Menu Template (ADMIN) -->
    <div id="service-menu-template">
        <h2 data-i18n="service.menu_title">Service Menu</h2>
        <div class="service-grid">
            <button class="service-card">
                <h3 data-i18n="service.diagnostics">System Diagnostics</h3>
                <p data-i18n="service.diagnostics_desc">Sprawd≈∫ stan systemu</p>
            </button>
            <button class="service-card">
                <h3 data-i18n="service.calibration">Calibration</h3>
                <p data-i18n="service.calibration_desc">Kalibracja czujnik√≥w</p>
            </button>
            <button class="service-card">
                <h3 data-i18n="service.backup">Backup</h3>
                <p data-i18n="service.backup_desc">Kopia zapasowa danych</p>
            </button>
        </div>
    </div>

    <!-- System Settings Template (SUPERUSER) -->
    <div id="system-settings-template">
        <h2 data-i18n="settings.title">System Settings</h2>
        <div class="settings-grid">
            <div class="setting-group">
                <h3 data-i18n="settings.network">Network Settings</h3>
                <label data-i18n="settings.ip_address">IP Address: <input type="text" value="192.168.1.10"></label>
                <label data-i18n="settings.port">Port: <input type="text" value="8080"></label>
            </div>
            <div class="setting-group">
                <h3 data-i18n="settings.system_config">System Configuration</h3>
                <label data-i18n="settings.update_interval">Update Interval: <input type="number" value="5"> seconds</label>
                <label data-i18n="settings.debug_mode">Debug Mode: <input type="checkbox"></label>
            </div>
        </div>
        <button class="btn btn-primary" data-i18n="actions.save_settings">Save Settings</button>
    </div>
</div>

<!-- Global Loading Overlay -->
<div id="loading-overlay" class="loading-overlay" style="display:none;">
    <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            <h3 data-i18n="loading.title">Logowanie...</h3>
            <p data-i18n="loading.message">Proszƒô czekaƒá</p>
        </div>
    </div>
</div>

<!-- MASKSERVICE C20 - Dependency Loader Bootstrap -->
<script>
    const cacheBuster = Date.now();
    
    // Load Dependency Loader first
    document.write('<script src="js/modules/dependency-loader.js?v=' + cacheBuster + '"><\/script>');
    
    // Configuration for dependency loading
    window.MASKSERVICE_CONFIG = {
        cacheBuster: cacheBuster,
        debug: window.location.search.includes('debug=true'),
        loadTimeout: 30000,
        baseUrl: 'js/',
        modulesUrl: 'js/modules/'
    };
</script>

<script>
    // Bootstrap application after dependency loader is available
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof window.DependencyLoader === 'undefined') {
            console.error('‚ùå DependencyLoader not available');
            return;
        }

        const loader = new DependencyLoader();
        
        // Configure loader
        loader.setBaseUrl(window.MASKSERVICE_CONFIG.baseUrl);
        loader.setCacheBuster(window.MASKSERVICE_CONFIG.cacheBuster);
        loader.setTimeout(window.MASKSERVICE_CONFIG.loadTimeout);
        
        // Define module dependencies and load order
        const moduleConfig = {
            // Core infrastructure modules (load first)
            'utils': { path: 'utils.js', deps: [] },
            'auth': { path: 'auth.js', deps: ['utils'] },
            'menu': { path: 'menu.js', deps: ['utils', 'auth'] },
            'i18n': { path: 'i18n.js', deps: ['utils'] },
            
            // Storage system modules
            'storage-core': { path: 'modules/storage-core.js', deps: [] },
            'storage-encryption': { path: 'modules/storage-encryption.js', deps: [] },
            'storage-compression': { path: 'modules/storage-compression.js', deps: [] },
            'storage-cleanup': { path: 'modules/storage-cleanup.js', deps: [] },
            'storage-stats': { path: 'modules/storage-stats.js', deps: [] },
            'storage-events': { path: 'modules/storage-events.js', deps: [] },
            'storage-manager': { path: 'modules/storage-manager.js', deps: [
                'storage-core', 'storage-encryption', 'storage-compression', 
                'storage-cleanup', 'storage-stats', 'storage-events'
            ]},
            
            // Configuration and utility modules
            'config-loader': { path: 'modules/config-loader.js', deps: ['utils'] },
            'inline-dialog': { path: 'modules/inline-dialog.js', deps: ['utils'] },
            
            // Router system modules
            'route-parser': { path: 'modules/route-parser.js', deps: ['utils'] },
            'navigation-manager': { path: 'modules/navigation-manager.js', deps: ['utils'] },
            'router': { path: 'router.js', deps: ['route-parser', 'navigation-manager', 'storage-manager', 'config-loader'] },
            
            // Settings system modules
            'settings-ui-generator': { path: 'modules/settings-ui-generator.js', deps: ['utils', 'inline-dialog'] },
            'settings-scenario-manager': { path: 'modules/settings-scenario-manager.js', deps: ['utils'] },
            'settings-integration-manager': { path: 'modules/settings-integration-manager.js', deps: ['utils'] },
            'settings-standards-validator': { path: 'modules/settings-standards-validator.js', deps: ['utils'] },
            'settings-system-config': { path: 'modules/settings-system-config.js', deps: ['utils'] },
            'system-settings-enhanced': { path: 'system-settings-enhanced.js', deps: [
                'settings-ui-generator', 'settings-scenario-manager', 'settings-integration-manager',
                'settings-standards-validator', 'settings-system-config', 'config-loader'
            ]},
            
            // Workshop system modules
            'workshop-core': { path: 'modules/workshop-core.js', deps: ['utils'] },
            'workshop-parts': { path: 'modules/workshop-parts.js', deps: ['utils'] },
            'workshop-maintenance': { path: 'modules/workshop-maintenance.js', deps: ['utils'] },
            'workshop-tools': { path: 'modules/workshop-tools.js', deps: ['utils'] },
            'workshop-inventory': { path: 'modules/workshop-inventory.js', deps: ['utils'] },
            'workshop-enhanced': { path: 'workshop-enhanced.js', deps: [
                'workshop-core', 'workshop-parts', 'workshop-maintenance', 
                'workshop-tools', 'workshop-inventory', 'config-loader'
            ]},
            
            // Reports system modules
            'reports-core': { path: 'modules/reports-core.js', deps: ['utils'] },
            'reports-generation': { path: 'modules/reports-generation.js', deps: ['utils'] },
            'reports-batch': { path: 'modules/reports-batch.js', deps: ['utils'] },
            'reports-schedule': { path: 'modules/reports-schedule.js', deps: ['utils'] },
            'reports-display': { path: 'modules/reports-display.js', deps: ['utils'] },
            'test-reports-enhanced': { path: 'test-reports-enhanced.js', deps: [
                'reports-core', 'reports-generation', 'reports-batch', 
                'reports-schedule', 'reports-display', 'config-loader'
            ]},
            
            // Test system modules
            'test-wizard': { path: 'modules/test-wizard.js', deps: ['utils'] },
            'test-quick': { path: 'modules/test-quick.js', deps: ['utils'] },
            'test-scenarios': { path: 'modules/test-scenarios.js', deps: ['utils'] },
            'test-menu-enhanced': { path: 'test-menu-enhanced.js', deps: [
                'test-wizard', 'test-quick', 'test-scenarios', 'config-loader'
            ]},
            
            // Device data system modules
            'sensor-monitoring': { path: 'modules/sensor-monitoring.js', deps: ['utils'] },
            'pressure-visualization': { path: 'modules/pressure-visualization.js', deps: ['utils'] },
            'device-history': { path: 'modules/device-history.js', deps: ['utils'] },
            'alarm-management': { path: 'modules/alarm-management.js', deps: ['utils'] },
            'device-data-enhanced': { path: 'device-data-enhanced.js', deps: [
                'sensor-monitoring', 'pressure-visualization', 
                'device-history', 'alarm-management', 'config-loader'
            ]},
            
            // Application modules
            'keyboard': { path: 'keyboard.js', deps: ['utils'] },
            'app': { path: 'app.js', deps: [
                'utils', 'auth', 'menu', 'i18n', 'router', 'keyboard',
                'system-settings-enhanced', 'workshop-enhanced', 
                'test-reports-enhanced', 'test-menu-enhanced', 'device-data-enhanced'
            ]},
            'ui-tester': { path: 'ui-tester.js', deps: ['app'] }
        };
        
        // Register all modules with the dependency loader
        Object.keys(moduleConfig).forEach(moduleName => {
            const config = moduleConfig[moduleName];
            loader.define(moduleName, config.deps, config.path);
        });
        
        // Load the application
        loader.require(['app', 'ui-tester'], function(app, uiTester) {
            console.log('üöÄ MASKSERVICE C20 application loaded successfully');
            if (window.MASKSERVICE_CONFIG.debug) {
                console.log('üìä Dependency loader stats:', loader.getLoadStats());
            }
        }).catch(function(error) {
            console.error('‚ùå Failed to load MASKSERVICE C20 application:', error);
            // Fallback to legacy loading if dependency loader fails
            console.warn('‚ö†Ô∏è Falling back to legacy script loading...');
            window.location.reload();
        });
    });
</script>
<!-- Modular architecture: utils ‚Üí auth ‚Üí menu ‚Üí i18n ‚Üí router ‚Üí keyboard ‚Üí app ‚Üí ui-tester -->
</body>
</html>
